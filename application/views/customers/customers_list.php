<!DOCTYPE html><html lang="en">    <head>        <meta charset="utf-8">        <meta http-equiv="X-UA-Compatible" content="IE=edge">        <meta name="viewport" content="width=device-width, initial-scale=1">        <meta name="description" content="">        <meta name="author" content="">        <link rel="icon" href="<?= site_url("library/images/hotel-flat-icon-vector.jpg") ?>">        <title>Customers</title>        <link href="<?= site_url("library/css/bootstrap.min.css") ?>" rel="stylesheet" type="text/css"/>        <link href="<?= site_url("library/css/datatables.min.css") ?>" rel="stylesheet" type="text/css"/>        <link href="<?= site_url("library/css/bootstrap-datepicker3.standalone.min.css") ?>" rel="stylesheet" type="text/css"/>        <link href="<?= site_url("assets/css/custom02.css") ?>" rel="stylesheet">        <style>            #modalDialog{                width:50%;            }        </style>    </head>    <body>        <?= $head02Temp ?>        <div class="container-fluid">            <div class="row">                <?= $leftmenu02Temp ?>                <div class="col-md-10 col-lg-offset-2">                    <div class="h3"><span>Customers</span><span class="addbttn"><button onclick="addCustomer()" class="btn btn-info">Add Customer</button></span></div>                    <table id="customer_list" class="table table-bordered table-striped table-hover">                        <thead>                            <tr>                                <th>Name</th>                                <th>Phone</th>                                <th>Status</th>                                <th>Type</th>                                <th>Date of issue</th>                                <th>Actions</th>                            </tr>                        </thead>                        <tbody>                        </tbody>                    </table>                </div>            </div>        </div>        <div id="customerDetails" class="modal fade" role="dialog">            <div id="modalDialog" class="modal-dialog  modal-lg">                <!-- Modal content-->                <div class="modal-content ">                    <div class="modal-header">                        <button type="button" class="close" data-dismiss="modal">&times;</button>                        <h4 class="modal-title">Customers</h4>                    </div>                    <div class="modal-body">                        <form method="post" name="customerDetailEdit" id="customerDetailEdit" >                            <div class="row">                                <div class="form-group col-md-6 mb-6">                                    <label for="cust_name">Name</label>                                    <input type="hidden" name="cust_id" id="cust_id" value="0" class="form-control">                                    <input type="text" name="cust_name" id="cust_name" class="form-control">                                    <div id='cust_nameError' class="errorlabel"></div>                                    <label for="cust_phone">Phone</label>                                    <input type="text" name="cust_phone" id="cust_phone" class="form-control">                                    <div id='cust_phoneError' class="errorlabel"></div>                                    <label for="cust_email">Email</label>                                    <input type="text" name="cust_email" id="cust_email" class="form-control">                                       <div id='cust_emailError' class="errorlabel"></div>                                    <label for="cust_status">Status</label>                                    <select class="custom-select d-block w-100 form-control" id="cust_status" name="cust_status"></select>                                    <div id='cust_statusError' class="errorlabel"></div>                                    <label class='memberCond' for="membership_type">Card Type</label>                                                                        <select class="custom-select d-block w-100 form-control memberCond" id="membership_type" name="membership_type"></select>                                    <input type="hidden" name="hdMembership_type" id="hdMembership_type" class="form-control">                                       <div id='membership_typeError' class="errorlabel"></div>                                    <label class='memberCond' for="membership_num">Card Number</label>                                    <input type="text" name="membership_num" id="membership_num" class="form-control memberCond">                                    <div id='membership_numError' class="errorlabel"></div>                                    <label class='memberCond' for="membership_issue_date">Card Issue Date</label>                                    <input type="text" name="membership_issue_date" id="membership_issue_date" class="form-control memberCond" readonly="readonly">                                    <input type="hidden" name="hdMembership_issue_date" id="hdMembership_issue_date" class="form-control">                                     <div id='membership_issue_dateError' class="errorlabel"></div>                                </div>                                <div class="form-group col-md-6 mb-6">                                    <label for="pan_card">Pan Card</label><input type="text" name="pan_card_value" id="pan_card_value" class="form-control">                                    <div id='pan_card_valueError' class="errorlabel"></div>                                    <label for="electoral_card">Electoral Card</label><input type="text" name="electoral_card_value" id="electoral_card_value" class="form-control">                                    <div id='electoral_cardError' class="errorlabel"></div>                                    <label for="aadhar_card">Aadhar Card</label><input type="text" name="aadhar_card_value" id="aadhar_card_value" class="form-control">                                    <div id='aadhar_cardError' class="errorlabel"></div>                                    <label for="driving_lic">Driving License</label><input type="text" name="driving_lic_value" id="driving_lic_value" class="form-control">                                    <div id='driving_licError' class="errorlabel"></div>                                    <label for="passport">Passport</label><input type="text" name="passport_value" id="passport_value" class="form-control">                                    <div id='passportError' class="errorlabel"></div><div id='errorDocument' class="errorlabel"></div>                                </div><!--checked="checked"-->                            </div>                            <div class="row">                                <div class="form-group col-md-12">                                    <label for="cust_address">Address</label>                                    <textarea name="cust_address" class="form-control" rows="5" cols="" id="cust_address"></textarea>                                    <span id='cust_addressError'></span>                                </div>                            </div>                            <div class="row">                                <div class="form-group col-md-6 mb-6">                                    <input id="submitBtn" type="button" class="btn btn-info" value="submit" >                                </div>                            </div>                        </form>                    </div>                </div>            </div>        </div>        <script src="<?= site_url("library/js/jquery.min.js") ?>" type="text/javascript"></script>        <script src="<?= site_url("library/js/bootstrap.min.js") ?>" type="text/javascript"></script>                <script src="<?= site_url("library/js/jquery.validate.min.js") ?>" type="text/javascript"></script>        <script src="<?= site_url("library/js/datatables.min.js") ?>" type="text/javascript"></script>        <script src="<?= site_url("library/js/bootstrap-datepicker.min.js") ?>" type="text/javascript"></script>        <script type="text/javascript">                        var dataTableCustomer = "<?= site_url("customers/ajaxAllCustomersMasterDataTable") ?>";                        var customerDetails = $("#customerDetails");                        var custStatus;                        var membershipType;                        var hotelId;                        $(document).ready(function () {                            hotelId = <?= $hotelId ?>;                            window.history.forward(-1);                            membershipType = "<?= addslashes(json_encode($membershipOptions)) ?>";                            custStatus = "<?= addslashes(json_encode(['Guest' => 'Guest', 'Member' => 'Member'])) ?>";                            hotelToMembership(hotelId);                            var table1 = $('#customer_list').DataTable({                                "ajax": {                                    url: dataTableCustomer,                                    type: 'GET'                                },                                "aoColumns": [                                    {mData: 'cust_name'},                                    {mData: 'cust_phone'},                                    {mData: 'cust_status'},                                    {mData: 'membership_type'},                                    {mData: 'membership_issue_date'},                                    {mData: "cust_id", bSortable: false, sWidth: "80px",                                        mRender: function (data, type, full) {                                            var editBtn = "<button class=\"btn btn-info btn-xs\" onclick=\"editCustomer(" + data + ")\">Edit</button>";                                            var delBtn = "<button class=\"btn btn-danger btn-xs\" onclick=\"deleteCustomer(" + data + ")\">Delete</button>";                                            return editBtn + "&nbsp;&nbsp;&nbsp;&nbsp;" + delBtn;                                        }                                    }                                ]                            });                        });                        function popOptions(options, dom_id, sel_id = "") {                            var optionsList = $.parseJSON(options);                            var arrCount = 0;                            $.each(optionsList, function (key, row) {                                arrCount++;                            });                            var option = arrCount > 2 ? "<option value=\"\">Choose...</option>" : "";                            $.each(optionsList, function (key, row) {                                var select = sel_id == key ? "selected='selected'" : "";                                option = option + "<option " + select + " value=\"" + key + "\">" + row + "</option>";                            });                            $(dom_id).html(option);                        }                        function addCustomer() {                            $("#membership_typeError").html("");                            $("#membership_numError").html("");                            $("#membership_issue_dateError").html("");                            $("#customerDetailEdit")[0].reset();                            $("#customerDetailEdit option").removeAttr("selected");                            $("#customerDetailEdit input:not(#submitBtn)").val("");                            $("#customerDetailEdit textarea").html("");                            $(".memberCond").hide();                            popOptions(custStatus, "#cust_status");                            $("#cust_status").val("Guest");                            $("#cust_status").attr("readonly", "readonly");                            hotelToMembership();                            customerDetails.modal("show");                        }                        function editCustomer(customer_id) {                            $("#membership_typeError").html("");                            $("#membership_numError").html("");                            $("#membership_issue_dateError").html("");                            $.ajax({                                type: "POST",                                url: "<?= site_url('customers/ajaxCustomerMasterDetails') ?>",                                data: {cust_id: customer_id},                                success: function (result) {                                    var data = $.parseJSON(result);                                    if (data['cust_status'] == 'Member') {                                        $("#cust_status").html("<option selected=\"selected\" value=\"Member\">Member</option>");                                        $("#cust_status").attr("readonly", "readonly");                                    } else {                                        popOptions(custStatus, "#cust_status", data['cust_status']);                                    }                                    $("input[name*='cust_name']").val(data['cust_name']);                                    $("input[name*='cust_email']").val(data['cust_email']);                                    $("input[name*='cust_phone']").val(data['cust_phone']);                                    $("input[name*='cust_id']").val(data['cust_id']);                                    $("input[name*='pan_card_value']").val(data['pan_card_value']);                                    $("input[name*='electoral_card_value']").val(data['electoral_card_value']);                                    $("input[name*='aadhar_card_value']").val(data['aadhar_card_value']);                                    $("input[name*='driving_lic_value']").val(data['driving_lic_value']);                                    $("input[name*='passport_value']").val(data['passport_value']);                                    $("input[name*='membership_issue_date']").val(data['membership_issue_date']);                                    $("input[name*='hdMembership_issue_date']").val(data['membership_issue_date']);                                    $("input[name*='membership_num']").val(data['membership_num']);                                    $("#cust_address").html(data['cust_address']);                                    $("input[name*='cust_id']").val(data['cust_id']);                                    isMemberStatus($("#cust_status").val());                                    hotelToMembership(hotelId, data['membership_type']);                                    $("input[name*='hdMembership_type']").val(data['membership_type']);                                    customerDetails.modal("show");                                }                            });                        }                        function refreshTable() {                            $.getJSON(dataTableCustomer, null, function (json) {                                table = $('#customer_list').dataTable();                                oSettings = table.fnSettings();                                table.fnClearTable(this);                                for (var i = 0; i < json['data'].length; i++) {                                    table.oApi._fnAddData(oSettings, json['data'][i]);                                }                                oSettings.aiDisplay = oSettings.aiDisplayMaster.slice();                                table.fnDraw();                            });                        }                        function deleteCustomer(customer_id) {                            var r = confirm("Do you really want to delete this record?");                            if (r == true) {                                $.ajax({                                    type: "POST",                                    url: "<?= site_url('customers/ajaxCustomerMasterDelete') ?>",                                    data: {cust_id: customer_id},                                    success: function (result) {                                        customerDetails.modal("hide");                                        refreshTable();                                    }                                });                            } else {                                customerDetails.modal("hide");                            }                        }                        $("#submitBtn").on("click", function () {                            var errorNo = 0;                            $(".errorlabel").html("");                            if (checkDocuments() == 1) {                                errorNo++;                            }                            if ($("input[name*='cust_name']").val().length < 1) {                                errorNo++;                                $("#cust_nameError").html("Required");                            }                            if ($("input[name*='cust_phone']").val().length < 1) {                                $("#cust_phoneError").html("Required");                                errorNo++;                            } else {                                $.ajax({                                    type: "POST",                                    async: false,                                    url: "<?= site_url('customers/ajaxUniqueCustomerHotelAttr') ?>",                                    data: {                                        primaryVal: $("#cust_id").val(),                                        hotelIdValue: hotelId,                                        attr: "cust_phone",                                        attrVal: $("#cust_phone").val()                                    },                                    success: function (result) {                                        if (result > 0) {                                            $("#cust_phoneError").html("Phone must be unique");                                            errorNo++;                                        }                                    }                                });                            }                            if ($("input[name*='cust_email']").val().length > 1) {                                $.ajax({                                    type: "POST",                                    async: false,                                    url: "<?= site_url('customers/ajaxUniqueCustomerHotelAttr') ?>",                                    data: {                                        primaryVal: $("#cust_id").val(),                                        hotelIdValue: hotelId,                                        attr: "cust_email",                                        attrVal: $("#cust_email").val()                                    },                                    success: function (result) {                                        if (result > 0) {                                            $("#cust_emailError").html("Email must be unique");                                            errorNo++;                                        }                                    }                                });                            }                            if ($("#cust_status").val() === 'Member') {                                if ($("#membership_type").val().length < 1) {                                    $("#membership_typeError").html("Required");                                    errorNo++;                                }                                if ($("input[name*='membership_num']").val() === "0"                                        || $("input[name*='membership_num']").val() === "") {                                    $("#membership_numError").html("Required");                                    errorNo++;                                }                                if ($("input[name*='membership_issue_date']").val() === "0"                                        || $("input[name*='membership_issue_date']").val() === "") {                                    $("#membership_issue_dateError").html("Required");                                    errorNo++;                                }                            }                            if (errorNo == 0) {                                $("#customerDetailEdit").submit();                            }                        });                        $("#customerDetailEdit").submit(function (e) {                            $.ajax({                                type: "POST",                                url: "<?= site_url('customers/ajaxCustomersMasterSubmit') ?>",                                data: $("#customerDetailEdit").serialize(),                                success: function (result) {                                    $("#customerDetailEdit")[0].reset();                                    customerDetails.modal("hide");                                    refreshTable();                                }                            });                            e.preventDefault();                        });                        function hotelToMembership(id = "", opt = "") {                            var hotelMembershipType = $.parseJSON(membershipType);                            var option = "<option value=\"\">Choose...</option>";                            if (id !== "" && $("#cust_status").val() == 'Member') {                                $.each(hotelMembershipType[id], function (key, row) {                                    var select = opt == key ? "selected='selected'" : "";                                    option = option + "<option " + select + " value=\"" + key + "\">" + row + "</option>";                                });                                $("#membership_type").html(option);                        }                        }                        function isMemberStatus(status) {                            if (status == "Guest") {                                $("#membership_type").html(                                        "<option value=\"\">Choose...</option>"                                        + "<option value=\"0\" selected='selected'>None</option>");                                $("#membership_num").val(0);                                $("#membership_issue_date").val(0);                                $(".memberCond").hide();                            } else {                                $(".memberCond").show();                                hotelToMembership(hotelId);                            }                        }                        $("#cust_status").on("change", function () {                            var valueSelected = this.value;                            $("#membership_typeError").html("");                            $("#membership_numError").html("");                            $("#membership_issue_dateError").html("");                            isMemberStatus(valueSelected);                        });                        $("#membership_issue_date").datepicker({                            format: "dd-mm-yyyy",                            weekStart: 1,                            daysOfWeekHighlighted: "0,6",                            autoclose: true                        });                        function checkDocuments() {                            var status = 0;                            var pan_card_value = $.trim($("input[name*='pan_card_value']").val());                            if (pan_card_value.length > 0) {                                $.ajax({                                    type: "POST",                                    async: false,                                    url: "<?= site_url('customers/ajaxUniqueCustDocAttr') ?>",                                    data: {                                        primaryVal: $("#cust_id").val(),                                        hotelIdValue: hotelId,                                        attr: "doc_number",                                        attrVal: pan_card_value                                    },                                    success: function (result) {                                        if (result > 0) {                                            $("#pan_card_valueError").html("Pan Card must be unique");                                            status ++;                                        }                                    }                                });                            }                            var electoral_card_value = $.trim($("input[name*='electoral_card_value']").val());                            if (electoral_card_value.length > 0) {                                $.ajax({                                    type: "POST",                                    async: false,                                    url: "<?= site_url('customers/ajaxUniqueCustDocAttr') ?>",                                    data: {                                        primaryVal: $("#cust_id").val(),                                        hotelIdValue: hotelId,                                        attr: "doc_number",                                        attrVal: electoral_card_value                                    },                                    success: function (result) {                                        if (result > 0) {                                            $("#electoral_cardError").html("Votar Card must be unique");                                            status ++;                                        }                                    }                                });                            }                            var aadhar_card_value = $.trim($("input[name*='aadhar_card_value']").val());                            if (aadhar_card_value.length > 0) {                                $.ajax({                                    type: "POST",                                    async: false,                                    url: "<?= site_url('customers/ajaxUniqueCustDocAttr') ?>",                                    data: {                                        primaryVal: $("#cust_id").val(),                                        hotelIdValue: hotelId,                                        attr: "doc_number",                                        attrVal: aadhar_card_value                                    },                                    success: function (result) {                                        if (result > 0) {                                            $("#aadhar_cardError").html("AAdhar Card must be unique");                                            status ++;                                        }                                    }                                });                            }                            var driving_lic_value = $.trim($("input[name*='driving_lic_value']").val());                            if (aadhar_card_value.length > 0) {                                $.ajax({                                    type: "POST",                                    async: false,                                    url: "<?= site_url('customers/ajaxUniqueCustDocAttr') ?>",                                    data: {                                        primaryVal: $("#cust_id").val(),                                        hotelIdValue: hotelId,                                        attr: "doc_number",                                        attrVal: driving_lic_value                                    },                                    success: function (result) {                                        if (result > 0) {                                            $("#driving_licError").html("Driving Licence must be unique");                                            status ++;                                        }                                    }                                });                            }                            var passport_value = $.trim($("input[name*='passport_value']").val());                            if (passport_value.length > 0) {                                $.ajax({                                    type: "POST",                                    async: false,                                    url: "<?= site_url('customers/ajaxUniqueCustDocAttr') ?>",                                    data: {                                        primaryVal: $("#cust_id").val(),                                        hotelIdValue: hotelId,                                        attr: "doc_number",                                        attrVal: passport_value                                    },                                    success: function (result) {                                        if (result > 0) {                                            $("#passportError").html("Passport must be unique");                                            status ++;                                        }                                    }                                });                            }                            if (pan_card_value.length > 0 || electoral_card_value.length > 0                                    || aadhar_card_value.length > 0 || driving_lic_value.length > 0                                    || passport_value.length > 0) {                                $("#errorDocument").html("");                            } else {                                $("#errorDocument").html("<p class='errorlabel'>Atleast one document need to be provided</p>");                                status ++;                            }                            if (status > 0) {                                return 1;                            } else {                                return 0;                            }                        }        </script>    </body></html>