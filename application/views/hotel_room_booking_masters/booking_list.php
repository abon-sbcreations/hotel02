<!DOCTYPE html><html lang="en">    <head>        <meta charset="utf-8">        <meta http-equiv="X-UA-Compatible" content="IE=edge">        <meta name="viewport" content="width=device-width, initial-scale=1">        <meta name="description" content="">        <meta name="author" content="">        <link rel="icon" href="<?= site_url("library/images/hotel-flat-icon-vector.jpg") ?>">        <title>Room's Master List</title>        <link href="<?= site_url("library/css/bootstrap.min.css") ?>" rel="stylesheet" type="text/css"/>        <link href="<?= site_url("library/css/datatables.min.css") ?>" rel="stylesheet" type="text/css"/>        <link href="<?= site_url("library/css/bootstrap-datepicker3.standalone.min.css") ?>" rel="stylesheet" type="text/css"/>        <link href="<?= site_url("assets/css/custom02.css") ?>" rel="stylesheet">        <style>            #modalDialog{                width:60%;            }        </style>    </head>    <body>        <?= $head02Temp ?>        <div class="container-fluid">            <div class="row">                <?= $leftmenu02Temp ?>                <div class="col-md-10 col-lg-offset-2">                    <div class="h3"><span>Booking List</span><span class="addbttn"><button onclick="addRoomBooking()" class="btn btn-info">New Booking</button></span></div>                    <table id="booking_listTbl" class="table table-bordered table-striped table-hover">                        <thead>                            <tr>                                <th>Customer</th>                                   <th>Adult&nbsp(count)</th>                                   <th>Child&nbsp(count)</th>                                 <th>Room&nbsp(count)</th>                                <th>Check In</th>                                <th>Check Out</th>                                <th>Actions</th>                            </tr>                        </thead>                        <tbody>                        </tbody>                    </table>                </div>            </div>        </div>        <div id="bookingListModal" class="modal fade" role="dialog">            <div id="modalDialog" class="modal-dialog  modal-lg">                <!-- Modal content-->                <div class="modal-content ">                    <div class="modal-header">                        <button type="button" class="close" data-dismiss="modal">&times;</button>                        <h4 class="modal-title">New Booking</h4>                    </div>                    <div class="modal-body">                        <form method="post" name="bookingListEdit" id="bookingListEdit" >                            <div class="row">                                <div class="form-group col-md-6 mb-6">                                    <input type="hidden" name="booking_id" id="booking_id" value="0" class="form-control">                                                                        <label for="customer_id">Customer</label>                                    <select id="customer_id"  class="form-control" name="customer_id"></select>                                    <div id="errCustomer_id"  class="errorlabel"></div>                                    <label for="adult_no">Adult Count</label>                                    <input type="number" value="1" min="1" name="adult_no" id="adult_no" class="form-control">                                    <div id="errAdult_no" class="errorlabel"></div>                                    <label for="child_no">Child Count</label>                                    <input type="number" value="0" min="0" name="child_no" id="child_no" class="form-control">                                    <div id="errChild_no" class="errorlabel"></div>                                 </div>                                                           <div class="form-group col-md-6 mb-6">                                    <label for="check_in">Check-In Date</label>                                    <input type="text" name="check_in" id="check_in" class="form-control">                                    <div id="errCheck_in" class="errorlabel"></div>                                       <label for="check_out">Check-Out Date</label>                                    <input type="text" name="check_out" id="check_out" class="form-control">                                    <div id="errCheck_out" class="errorlabel"></div>                                                                    </div>                            </div>                            <div class="row">                                <div class="form-group col-md-4 mb-3">                                    <input id="submitBtn" type="button" class="btn btn-info" value="submit" >                                </div>                            </div>                        </form>                    </div>                </div>            </div>        </div>        <div id="bookingDetailsModal" class="modal fade" role="dialog">            <div id="modalDialog" class="modal-dialog  modal-lg">                <!-- Modal content-->                <div class="modal-content ">                    <div class="modal-header">                        <button type="button" class="close" data-dismiss="modal">&times;</button>                        <h4 class="modal-title">Room Booking Details</h4>                    </div>                    <div class="modal-body">                        <form method="post" name="bookingDetailsEdit" id="bookingDetailsEdit" >                            <div class="row">                                <div id="" class="form-group col-md-10 mb-10">                                    <input type="hidden" name="detBooking_id" id="detBooking_id" value="0" class="form-control">                                                                        <table id="tblRoomList" class="table table-bordered table-hover">                                        <thead>                                            <tr>                                                <td>Room&nbsp;Number</td><!--Available&nbsp;Room-->                                                <td>Room&nbsp;Type</td>                                                <td>Check-in</td>                                                <td>Check-out</td>                                                <td>Rent&nbsp;(per day)</td>                                            </tr>                                        </thead>                                        <tbody></tbody>                                    </table>                                    <div id="errRoomSelect" class="errorlabel"></div>                                </div>                            </div>                            <div class="row">                                <div class="form-group col-md-4 mb-3">                                    <input id="submitDetailsBtn" type="button" class="btn btn-info" value="submit" >                                </div>                            </div>                        </form>                    </div>                </div>            </div>        </div>        <script src="<?= site_url("library/js/jquery.min.js") ?>" type="text/javascript"></script>        <script src="<?= site_url("library/js/bootstrap.min.js") ?>" type="text/javascript"></script>        <script src="<?= site_url("library/js/jquery.validate.min.js") ?>" type="text/javascript"></script>        <script src="<?= site_url("library/js/datatables.min.js") ?>" type="text/javascript"></script>        <script src="<?= site_url("library/js/bootstrap-datepicker.min.js") ?>" type="text/javascript"></script>        <script type="text/javascript">                        var dataRoomBookingTable = "<?= site_url("hotel_room_booking_masters/ajaxAllRoomBookingMasterDataTable") ?>";                        var booking_listTbl = $("#booking_listTbl");                        var bookingListModal = $("#bookingListModal");                        var customerOptions;                        var roomTypeOptions;                        bookingListEdit = $("#bookingListEdit")                        $(document).ready(function () {                            window.history.forward(-1);                            $("#check_in").attr("readonly", "readonly");                            $("#check_out").attr("readonly", "readonly");                            customerOptions = "<?= addslashes(json_encode($customerOptions)) ?>";                            roomTypeOptions = "<?= addslashes(json_encode($roomTypeOptions)) ?>";                            availableRoomsList = "<?= addslashes(json_encode($availableRoomsList)) ?>";                            var table1 = $('#booking_listTbl').DataTable({                                "ajax": {                                    url: dataRoomBookingTable,                                    type: 'GET'                                },                                "oLanguage": {                                    "sEmptyTable": "No Record Found"                                },                                "aoColumns": [                                    {mData: 'cust_name'}, {mData: 'adult_no'},                                    {mData: 'child_no'}, {mData: 'room_count'},                                    {mData: 'check_in'}, {mData: 'check_out'},                                    {mData: "booking_id", bSortable: false, sWidth: "80px",                                        mRender: function (data, type, full) {                                            var editBtn = "<button class=\"btn btn-info btn-xs\" onclick=\"editRoomBooking(" + data + ")\">Edit</button>";                                            var delBtn = "<button class=\"btn btn-warning btn-xs\" onclick=\"detailsRoomBooking(" + data + ")\">Details</button>";                                            return editBtn + "&nbsp;&nbsp;&nbsp;&nbsp;" + delBtn;                                        }                                    }                                ]                            });                            $("[type='number']").keypress(function (evt) {                                evt.preventDefault();                            });                        });                        function addRoomBooking() {                            $("#bookingListEdit input:not(#submitBtn)").val("");                            $("#bookingListEdit option").removeAttr("selected");                            $("#bookingListEdit")[0].reset();                            popOptions(customerOptions, "#customer_id");                            bookingListModal.modal("show");                        }                        function editRoomBooking(booking_id) {                            $.ajax({                                type: "POST",                                url: "<?= site_url('hotel_room_booking_masters/ajaxRoomBookingMasterDetails') ?>",                                data: {booking_id: booking_id},                                success: function (result) {                                    var data = $.parseJSON(result);                                    $("input[name*='booking_id']").val(data['booking_id']);                                    $("input[name*='adult_no']").val(data['adult_no']);                                    $("input[name*='child_no']").val(data['child_no']);                                    $("input[name*='check_in']").val(data['check_in']);                                    $("input[name*='check_out']").val(data['check_out']);                                    popOptions(customerOptions, "#customer_id", data['customer_id']);                                    bookingListModal.modal("show");                                }                            });                        }                        function refreshTable() {                            $.getJSON(dataRoomBookingTable, null, function (json) {                                table = $('#booking_listTbl').dataTable();                                oSettings = table.fnSettings();                                table.fnClearTable(this);                                for (var i = 0; i < json['data'].length; i++) {                                    table.oApi._fnAddData(oSettings, json['data'][i]);                                }                                oSettings.aiDisplay = oSettings.aiDisplayMaster.slice();                                table.fnDraw();                            });                        }                        function detailsRoomBooking(booking_id) {                            var roomsList = $.parseJSON(availableRoomsList);                            var roomTypeList = $.parseJSON(roomTypeOptions);                            $("#detBooking_id").val(booking_id);                            $.ajax({                                type: "POST",                                async: true,                                url: "<?= site_url('hotel_room_booking_masters/ajaxRoomBookingDetails') ?>",                                data: {booking_id: booking_id},                                success: function (result) {                                    $("#tblRoomList tbody").html("");                                    var bookingDetails = $.parseJSON(result);                                    $.each(roomsList, function (key1, row1) {                                        var nameId = "room_assign_type_" + row1['room_id'];                                        var select = "<select id='" + nameId + "' class=\"form-control \" name='" + nameId + "'><option value=\"\">Choose...</option>";                                        var price = {};                                        $.each(roomTypeList, function (key2, row2) {                                            var selected = row1['hotel_room_master_id'] == row2['hotel_room_master_id'] ? "selected='selected'" : "";                                            select += "<option " + selected + " value=" + row2['hotel_room_master_id'] + ">" + row2['room_type'] + "</option>";                                            price[row2['hotel_room_master_id']] = row2['hotel_room_rent'];                                        });                                        select += "</select>";                                        var check_inId = "check_in_" + row1['room_id'];                                        var check_outId = "check_out_" + row1['room_id'];                                        var checkboxId = "room_check_" + row1['room_id'];                                        var rowId = "row_" + row1['room_id'];                                        var room_rent = "room_rent_" + row1['room_id'];                                        $("#tblRoomList tbody").append("<tr id='" + rowId + "' data-id='" + row1['room_id'] + "'><td><input type='checkbox' name='" + checkboxId + "' id='" + checkboxId + "'>" + row1['room_number'] + "</td>"                                                + "<td>" + select + "<div id=\"" + nameId + "Error\" class=\"errorlabel\"></div></td>"                                                + "<td><input type=\"text\" name='" + check_inId + "' id='" + check_inId + "' class=\"form-control bookingDate\" readonly='readonly'>"                                                + "<div id=\"" + check_inId + "Error\" class=\"errorlabel\"></div></td>"                                                + "<td><input type=\"text\" name='" + check_outId + "' id='" + check_outId + "' class=\"form-control bookingDate\" readonly='readonly'>"                                                + "<div id=\"" + check_outId + "Error\" class=\"errorlabel\"></div></td>"                                                + "<td><span id=\"" + room_rent + "\">" + price[row1['hotel_room_master_id']] + "</span></td></tr>");                                        $("#room_assign_type_" + row1['room_id']).attr("disabled", "disabled");                                        $("#check_in_" + row1['room_id']).attr("disabled", "disabled");                                        $("#check_out_" + row1['room_id']).attr("disabled", "disabled");                                        $.each(bookingDetails, function (key3, bDetails) {                                            if (bDetails['room_id'] == row1['room_id']) {                                                $("#room_check_" + row1['room_id']).attr("checked", "checked");                                                $("#check_in_" + row1['room_id']).val(bDetails['check_in']);                                                $("#check_out_" + row1['room_id']).val(bDetails['check_out']);                                                $("#room_assign_type_" + row1['room_id']).val(bDetails['room_assigned_type']);                                                $("#room_assign_type_" + row1['room_id']).removeAttr("disabled");                                                $("#check_in_" + row1['room_id']).removeAttr("disabled");                                                $("#check_out_" + row1['room_id']).removeAttr("disabled");                                            }                                        });                                        $(".bookingDate").datepicker({                                            format: "dd-mm-yyyy",                                            weekStart: 1,                                            daysOfWeekHighlighted: "0,6",                                            autoclose: true                                        });                                        $(document).on("change", "#" + nameId, function () {                                            $("#room_rent_" + row1['room_id']).html(price[this.value]);                                        });                                        $(document).on("click", "#" + checkboxId, function () {                                            if ($(this).is(":checked")) {                                                $("tr#row_" + row1['room_id'] + " .errorlabel").html("");                                                $("#room_assign_type_" + row1['room_id']).removeAttr("disabled");                                                $("#check_in_" + row1['room_id']).removeAttr("disabled");                                                $("#check_out_" + row1['room_id']).removeAttr("disabled");                                            } else {                                                $("tr#row_" + row1['room_id'] + " .errorlabel").html("");                                                $("#room_assign_type_" + row1['room_id']).attr("disabled", "disabled");                                                $("#check_in_" + row1['room_id']).attr("disabled", "disabled");                                                $("#check_out_" + row1['room_id']).attr("disabled", "disabled");                                            }                                        });                                    });                                }                            });                            refreshTable();                            $("#bookingDetailsModal").modal("show");                        }                        $("#submitDetailsBtn").on("click", function () {                            $(".errorlabel").html("");                            var errorNo = 0;                            var checkRoom = 0;                            var roomsList = $.parseJSON(availableRoomsList);                            $.each(roomsList, function (key1, row1) {                                if ($("#room_check_" + row1['room_id']).is(":checked")) {                                    checkRoom = 1;                                    if ($("#room_assign_type_" + row1['room_id']).val().length == 0) {                                        errorNo++;                                        $("#room_assign_type_" + row1['room_id'] + "Error").html("Required");                                    }                                    if ($("#check_in_" + row1['room_id']).val().length == 0) {                                        errorNo++;                                        $("#check_in_" + row1['room_id'] + "Error").html("Required");                                    }                                }                            });                            if (checkRoom == 0) {                                $("#errRoomSelect").html("Atleast One Room Need to be Checked");                                errorNo++;                            }                            if (errorNo == 0) {                                $("#bookingDetailsEdit").submit();                            }                        });                        $("#bookingDetailsEdit").submit(function (e) {                            $.ajax({                                type: "POST",                                url: "<?= site_url('hotel_room_booking_masters/ajaxRoomBookingDetailsSubmit') ?>",                                data: $("#bookingDetailsEdit").serialize(),                                success: function (result) {                                    $("#bookingDetailsEdit")[0].reset();                                    $("#bookingDetailsModal").modal("hide");                                }                            });                            e.preventDefault();                        });                        $("#submitBtn").on("click", function () {                            $(".errorlabel").html("");                            var errorNo = 0;                            if ($("#customer_id").val().length == 0) {                                $("#errCustomer_id").html("Required");                                errorNo++;                            }                            if ($("#adult_no").val().length == 0) {                                $("#errAdult_no").html("Required");                                errorNo++;                            } else if (!$.isNumeric($("#adult_no").val())) {                                $("#errAdult_no").html("Numeric Value only");                                errorNo++;                            } else if ($("#adult_no").val() < 1) {                                $("#errAdult_no").html("Atleast 1 Adult is required");                            }                            if ($("#check_in").val().length == 0) {                                $("#errCheck_in").html("Required");                                errorNo++;                            }                            if (errorNo == 0) {                                $("#bookingListEdit").submit();                            }                        });                        $("#bookingListEdit").submit(function (e) {                            $.ajax({                                type: "POST",                                url: "<?= site_url('hotel_room_booking_masters/ajaxRoomBookingMasterSubmit') ?>",                                data: $("#bookingListEdit").serialize(),                                success: function (result) {                                    $("#bookingListEdit")[0].reset();                                    bookingListModal.modal("hide");                                    refreshTable();                                }                            });                            e.preventDefault();                        });                        function popOptions(options, dom_id, sel_id = "") {                            var optionsList = $.parseJSON(options);                            var arrCount = 0;                            $.each(optionsList, function (key, row) {                                arrCount++;                            });                            var option = arrCount > 2 ? "<option value=\"\">Choose...</option>" : "";                            $.each(optionsList, function (key, row) {                                var select = sel_id == key ? "selected='selected'" : "";                                option = option + "<option " + select + " value=\"" + key + "\">" + row + "</option>";                            });                            $(dom_id).html(option);                        }                        $("#check_in").datepicker({                            format: "dd-mm-yyyy",                            weekStart: 1,                            daysOfWeekHighlighted: "0,6",                            autoclose: true                        });                        $("#check_out").datepicker({                            format: "dd-mm-yyyy",                            weekStart: 1,                            daysOfWeekHighlighted: "0,6",                            autoclose: true                        });                        /*function deleteRoomBooking(booking_id) {                         var r = confirm("Do you really want to delete this record?");                         if (r == true) {                         $.ajax({                         type: "POST",                         url: "<?= site_url('hotel_room_booking_masters/ajaxRoomBookingMasterDelete') ?>",                         data: {booking_id: booking_id},                         success: function (result) {                         bookingListModal.modal("hide");                         refreshTable();                         }                         });                         } else {                         bookingListModal.modal("hide");                         }                         }*/        </script>    </body></html>