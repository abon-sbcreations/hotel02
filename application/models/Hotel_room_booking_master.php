<?phpclass Hotel_room_booking_master extends CI_Model {    private $_hotel_room_booking_master = "hotel_room_booking_master";    private $_hotel_room_booking_details = "hotel_room_booking_details";    private $_customer_master = "customer_master";    private $_tbl_hotel_master = "tbl_hotel_master";     private $_hotel_room_lists = "hotel_room_lists";     private $_tbl_room_master = "tbl_room_master";     private $_tbl_hotel_room_detail = "tbl_hotel_room_detail";    public function getHotelRoomBookingDetails($params) {        $this->db->select("hrbm.booking_id,hrbm.customer_id,cm.cust_name,hrbm.hotel_id,hm.hotel_name,hrbm.adult_no,"                          ."hrbm.child_no,hrbm.check_in,hrbm.check_out");        $this->db->from($this->_hotel_room_booking_master." as hrbm");        $this->db->join($this->_customer_master." as cm","cm.cust_id = hrbm.customer_id","left");        $this->db->join($this->_tbl_hotel_master." as hm","hm.hotel_id = hrbm.hotel_id","left");                if (isset($params['where']) && !empty($params['where'])) {            $this->db->where($params['where']);        }        if (isset($params['where_in']) && !empty($params['where_in'])) {            $this->db->where_in($params['where_in']['attr'],$params['where_in']['list']);        }        $query = $this->db->get();        $results = $query->result_array();        $bookings = [];        foreach ($results as $k=>$result){               $result['room_count'] = $this->getRoomCountFromDetails(['where'=>['booking_id'=>$result['booking_id']]]);           $bookings[] = $result;        }        return $bookings;    }    private function getRoomCountFromDetails($arr){         $this->db->from($this->_hotel_room_booking_details);         if(!empty($arr['where'])){             $this->db->where($arr['where']);         }        return $this->db->count_all_results();       }    public function postHotelRoomBookingMasters($hrbm) {        $this->db->insert($this->_hotel_room_booking_master, [            'customer_id'=>$hrbm['customer_id'],            'hotel_id'=>$this->session->userdata('hotel_id'),            'adult_no'=>$hrbm['adult_no'],            'child_no'=>$hrbm['child_no'],            'check_in'=>$hrbm['check_in'],            'check_out'=>$hrbm['check_out']                ]);    }    public function getRoomBookingDetails($params){        $this->db->from($this->_hotel_room_booking_details." as hrbd");        $this->db->where($params['where']);        $query = $this->db->get();        return $query->result_array();    }    public function postHotelRoomBookingDetails($post){                $this->db->delete($this->_hotel_room_booking_details,[            'booking_id'=>$post['detBooking_id']        ]);        $rooms = $this->getAvailableRooms();        $detailsArr = [];        $room_status = [];        foreach ($rooms as $k => $room){                      if(isset($post["room_check_".$room['room_id']])){               $room_nos[] = [                   'room_number'=>$room['room_number'],                   'room_status'=>'occupied',                   ];                              $detailsArr[] = [                 'booking_id'=>$post['detBooking_id'],                 'room_id'=>$room['room_id'],                 'room_assigned_type'=>$post['room_assign_type_'.$room['room_id']],                 'check_in'=> $post["check_in_".$room['room_id']],                 'check_out'=> $post["check_out_".$room['room_id']],                 'hotel_id'=>$this->session->userdata('hotel_id')               ];           }        }        $this->db->insert_batch($this->_hotel_room_booking_details,$detailsArr);    }        public function putHotelRoomBookingMasters($hrbm) {        $this->db->update($this->_hotel_room_booking_master, [            'customer_id'=>$hrbm['customer_id'],            'hotel_id'=>$this->session->userdata('hotel_id'),            'adult_no'=>$hrbm['adult_no'],            'child_no'=>$hrbm['child_no'],            'check_in'=>$hrbm['check_in'],            'check_out'=>$hrbm['check_out'],                ],['booking_id'=>$hrbm['booking_id']]);    }    public function getAvailableRooms(){          $this->db->select("thrd.hotel_room_master_id,trm.room_type,hrl.room_id,hrl.room_number");        $this->db->from($this->_tbl_hotel_master." as thm");        $this->db->join($this->_tbl_hotel_room_detail." as thrd","thrd.hotel_id = thm.hotel_id","left");        $this->db->join($this->_tbl_room_master." as trm","thrd.hotel_room_type = trm.room_master_id","left");        $this->db->join($this->_hotel_room_lists." as hrl","hrl.hotel_room_type = thrd.hotel_room_master_id","left");        $this->db->where(['hrl.room_status'=>"empty",'hrl.isVarified'=>'Y','thrd.hotel_id'=>$this->session->userdata('hotel_id')]);        $qry = $this->db->get();        return $qry->result_array();    }    public function getAvailableRoomTypes(){        $this->db->select("thm.hotel_id,thrd.hotel_room_master_id,thrd.hotel_room_type,thrd.hotel_room_rent,"                ."thrd.hotel_room_amenities,trm.room_type,thrd.hotel_room_rent");        $this->db->from($this->_tbl_hotel_master." as thm");        $this->db->join($this->_tbl_hotel_room_detail." as thrd","thrd.hotel_id = thm.hotel_id","left");        $this->db->join($this->_tbl_room_master." as trm","thrd.hotel_room_type = trm.room_master_id","left");        $this->db->where(['thrd.hotel_id'=>$this->session->userdata('hotel_id')]);        $qry = $this->db->get();        return $qry->result_array();    }    public function deleteHotelRoomBookingDetails($where) {        $this->db->delete($this->_hotel_room_booking_master, $where);    }}