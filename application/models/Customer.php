<?phpclass Customer extends CI_Model {    private $_customer_master = "customer_master";    private $_tbl_hotel_master = "tbl_hotel_master";      private $_customer_doc_master = "customer_doc_master";    private $_hotel_membership_master = "hotel_membership_master";    public function getCustomer($params) {        $this->db->select("cm.cust_id,cm.hotel_id,hmm.membership_validity,thm.hotel_name,cm.cust_name,cm.cust_phone,"           ."cm.cust_email,cm.cust_status,cm.membership_type,cm.membership_num,cm.membership_issue_date,cm.cust_address");        $this->db->from($this->_customer_master." as cm");        $this->db->join($this->_tbl_hotel_master." as thm","thm.hotel_id = cm.hotel_id","left");        $this->db->join($this->_hotel_membership_master." as hmm","cm.membership_type = hmm.membership_id","left");        if (isset($params['where']) && !empty($params['where'])) {            $this->db->where($params['where']);        }        $query = $this->db->get();        $customers = $query->result_array();        $totalCustomer = [];        foreach ($customers as $index => $cust){           $docs = $this->getCustomerDoc($cust['cust_id']);           foreach ($docs as $att=>$val2){               foreach ($val2 as $attr2=>$val2){                   $cust[$attr2] = $val2;               }            }           $totalCustomer[] = $cust;        }        return $totalCustomer;    }    public function postCustomer($customer) {        $this->db->insert($this->_customer_master, [            'cust_id'=>$customer['cust_id'],'hotel_id'=>$this->session->userdata('hotel_id'),            'cust_name'=>$customer['cust_name'],'cust_phone'=>$customer['cust_phone'],            'cust_email'=>$customer['cust_email'],'cust_status'=>$customer['cust_status'],            'membership_type'=> isset($customer['membership_type'])?$customer['membership_type']:0,            'membership_num'=>isset($customer['membership_num'])? $customer['membership_num']:0,            'membership_issue_date'=>isset($customer['membership_issue_date'])? $customer['membership_issue_date']:0,'cust_address'=>$customer['cust_address']            ]);            $this->setCustomerDoc($this->db->insert_id(), $customer);    }    public function putCustomer($customer) {        $this->db->update($this->_customer_master, [            'cust_name'=>$customer['cust_name'],'cust_phone'=>$customer['cust_phone'],            'cust_email'=>$customer['cust_email'],'cust_status'=>$customer['cust_status'],            'membership_type'=> isset($customer['membership_type'])?$customer['membership_type']:0,            'membership_num'=>isset($customer['membership_num'])? $customer['membership_num']:0,            'membership_issue_date'=>isset($customer['membership_issue_date'])? $customer['membership_issue_date']:0,'cust_address'=>$customer['cust_address']],            ['cust_id'=>$customer['cust_id']]);        $this->setCustomerDoc($customer['cust_id'], $customer);    }    private function setCustomerDoc($customer_id,$post){        $this->db->delete($this->_customer_doc_master,['cust_id'=>$customer_id]);        $docList = ['pan_card_value'=>'Pan','electoral_card_value'=>'Voter','aadhar_card_value'=>'Aadhar',            'driving_lic_value'=>'Driving','passport_value'=>'Passport'];        foreach ($post as $key=>$value){            if(isset($docList[$key]) && !empty($value)){                $this->db->insert($this->_customer_doc_master,[                    'cust_id'=>$customer_id,                                        'hotel_id'=>  $this->session->userdata('hotel_id'),                    'doc_type'=> $docList[$key],                    'doc_number'=> $value	                ]);            }        }    }    private function getCustomerDoc($cust_id){        $this->db->select("*");                $this->db->from($this->_customer_doc_master);        $this->db->where(['cust_id'=>$cust_id]);        $query = $this->db->get();        $result = $query->result_array();        $docList = ['Pan'=>'pan_card_value','Voter'=>'electoral_card_value','Aadhar'=>'aadhar_card_value',           'Driving'=>'driving_lic_value','Passport'=>'passport_value'];        $docs = [];        foreach ($result as $index => $row){           $docs[] = ['cust_id'=>$cust_id,               $docList[$row['doc_type']] => $row['doc_number']];        }        return $docs;    }    public function deleteCustomer($where) {        $this->db->delete($this->_customer_master, $where);    }}